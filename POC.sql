--Customer Table--
CREATE TABLE Customer (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) UNIQUE NOT NULL,
    address VARCHAR2(255),
    password VARCHAR2(255) NOT NULL
);

SELECT * FROM Customer;

COMMIT;

--Account Table--
CREATE TABLE Account (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    customer_id NUMBER NOT NULL,
    balance NUMBER(10, 2) DEFAULT 0,
    account_type VARCHAR2(50),
    FOREIGN KEY (customer_id) REFERENCES Customer(id)
);

select * from ACCOUNT;

ALTER TABLE Account ADD account_number VARCHAR2(20) NOT NULL UNIQUE;

desc ACCOUNT

--Transaction Table--
CREATE TABLE Transaction (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    account_id NUMBER NOT NULL,
    amount NUMBER(10, 2) NOT NULL,
    transaction_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    transaction_type VARCHAR2(50),
    FOREIGN KEY (account_id) REFERENCES Account(id)
);

--New Columns needs for BankStaff to Perform Operation--
ALTER TABLE Transaction ADD (
STATUS VARCHAR2(20) DEFAULT 'PENDING' NOT NULL,
APPROVAL_DATE TIMESTAMP,
APPROVED_BY NUMBER,
TO_ACCOUNT_ID NUMBER,
CONSTRAINT FK_TRANSACTION_STAFF FOREIGN KEY (APPROVED_BY) REFERENCES BANKSTAFF(ID),
CONSTRAINT FK_TRANSACTION_TO_ACCOUNT FOREIGN KEY (TO_ACCOUNT_ID) REFERENCES ACCOUNT(ID)
);


--BillPayment Table--
CREATE TABLE BillPayment (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    customer_id NUMBER NOT NULL,
    amount NUMBER(10, 2) NOT NULL,
    payment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES Customer(id)
);

--BankStaff Table--
CREATE TABLE BankStaff (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) UNIQUE NOT NULL,
    password VARCHAR2(255) NOT NULL
);

SELECT * FROM BANKSTAFF;

---No Need of This----
ALTER TABLE BankStaff ADD CONSTRAINT unique_email UNIQUE (email);
ALTER TABLE BankStaff MODIFY email VARCHAR(255) NOT NULL;
ALTER TABLE BankStaff MODIFY name VARCHAR(255) NOT NULL;
ALTER TABLE BankStaff MODIFY password VARCHAR(255) NOT NULL;


CREATE TABLE ADMIN (
    ID NUMBER PRIMARY KEY,
    EMAIL VARCHAR2(255) NOT NULL UNIQUE,
    PASSWORD VARCHAR2(255) NOT NULL
);

Select * from Admin;

select * from Account;

Select * from BANKSTAFF;
--------------------------------------------------
--Customer Table Sequence--
CREATE SEQUENCE customer_seq
    START WITH 1
    MINVALUE 1
    MAXVALUE 100
    INCREMENT BY 1
    NOCACHE;
    
--Account Table Sequence--
CREATE SEQUENCE account_seq
    START WITH 1
    MINVALUE 1
    MAXVALUE 100
    INCREMENT BY 1
    NOCACHE;
    
--Transaction Table Sequence--
CREATE SEQUENCE transaction_seq
    START WITH 1
    MINVALUE 1
    MAXVALUE 100
    INCREMENT BY 1
    NOCACHE;

--BillPayment Table Sequence--
CREATE SEQUENCE billpayment_seq
    START WITH 1
    MINVALUE 1
    MAXVALUE 100
    INCREMENT BY 1
    NOCACHE;
    
--BankStaff Table Sequence--
CREATE SEQUENCE bankstaff_seq
    START WITH 1
    MINVALUE 1
    MAXVALUE 100
    INCREMENT BY 1
    NOCACHE;
    
--Admin Table Sequence--
CREATE SEQUENCE admin_seq
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

    
----------------------------------
CREATE OR REPLACE DIRECTORY DATA_PUMP_DIR AS 'D:\Eclipse2022\oracle_backups';
GRANT READ, WRITE ON DIRECTORY DATA_PUMP_DIR TO system;